#!/usr/bin/python

filename = '/home/crouchr/malware-domains.csv'                      # real file
file     = open(filename,'r')

# ------------
# tail -f mode
# ------------

# Find the size of the Tweets queue file and move to the end
#st_results = os.stat(filename)
#st_size    = st_results[6]
#file.seek(st_size)

vfasn = ["3209","25135","34419"]


print "system     : Process " + filename

try:

    while True:
    
        line  = file.readline().rstrip()
        #print "\nline=" + "[" + line + "]"
        l     = len(line)
        #print "len(line)=" + `l`
                                            
        if (l > 0 and l <= 3) : # caused by AMUN logs - need to fix at source but this adds some pro
            print "Short line read, len=" + `l` + " so ignore..."
        elif not line :         # no data to process
            os.exit()
            #print "kojoney_tweet_engine.py : nothing in Tweets queue to process"          
        else:
            fields=line.split(",")
            #print fields
            url = fields[1]
            ip  = fields[2]
            asn = fields[6].strip('"')
            cc  = fields[8]
            
            #msg = "url=" + url + " ip=" + ip + " cc=" + cc + " asn=" + asn
            #print msg
            
            for myas in vfasn:
                if asn == myas :
                    print "Vodafone AS found : " + asn
                    msg = "url=" + url + " ip=" + ip + " cc=" + cc + " asn=" + asn
                    print msg
                #else:
                #    print asn + " ne " + myas          
                  
except Exception,e:
    print "parse_malware_domains.py : main() exception caught = " + `e` + " line=" + line
    #syslog.syslog("kojoney_tweet_engine.py : main() exception caught = " + `e` + " line=" + line                                                                                                                                                    