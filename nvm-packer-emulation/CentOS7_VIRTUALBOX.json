{
  "description": "The description goes here",
  "_comment": "Template for building Test Kitchen CentOS7 VirtualBox Image",

      "variables": {
        "stack_name": "",
        "aws_cloud": "",
        "aws_swproxy_version": "",
        "box_basename": "",
        "http_directory": "http",
        "build_timestamp": "",
        "cpus": "",
        "disk_size": "",
        "headless": "true",
        "http_proxy": "",
        "https_proxy": "",
        "hyperv_generation": "",
        "hyperv_switch": "",
        "guest_additions_url": "",
        "iso_checksum": "",
        "iso_checksum_type": "",
        "iso_name": "",
        "ks_path": "",
        "memory": "",
        "no_proxy": "",
        "template": "",
        "sw_proxy_fqdn": "",
        "sw_proxy_ip": "",
        "aws_swproxy_prereq_dir": "",
        "aws_swproxy_activation_key": "",
        "chef_ip": "",
        "chef_fqdn": "",
        "chef_omnibus_version": "",
        "testing_cis_level": "",
        "file_system": ""
      },

  "builders": [  {
      "type": "virtualbox-iso",
      "export_opts":
              [
                "--manifest",
                "--vsys", "0",
                "--description", "{{ user `box_description` }}",
                "--version", "{{ user `box_version` }}"
              ],
      "boot_command": [
          "<up><wait><tab> text ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/{{user `ks_path`}}<enter><wait>"
        ],

        "vm_name": "{{ user `template` }}",
        "boot_wait": "10s",
        "disk_size": "{{user `disk_size`}}",
        "guest_additions_path": "VBoxGuestAdditions.iso",
        "guest_os_type": "RedHat_64",
        "hard_drive_interface": "sata",
        "headless": "{{ user `headless` }}",
        "http_directory": "{{user `http_directory`}}",
        "iso_urls": [
          "http://mozart.ee.ic.ac.uk/CentOS/7/isos/x86_64/{{user `iso_filename`}}",
          "http://mirror.netweaver.uk/centos/7/isos/x86_64/{{user `iso_filename`}}",
          "http://mirror.ox.ac.uk/sites/mirror.centos.org/7/isos/x86_64/{{user `iso_filename`}}"
        ],
        "iso_checksum":"{{ user `iso_checksum` }}",
        "output_directory": "{{ user `build_directory` }}/packer-{{user `template`}}-virtualbox",
        "ssh_password": "vagrant",
        "ssh_port": 22,
        "ssh_username": "vagrant",
        "ssh_wait_timeout": "10000s",
        "shutdown_command": "echo 'packer' | sudo -S shutdown -P now",
        "memory": "{{ user `memory` }}",
        "cpus": "{{ user `cpus` }}",
        "virtualbox_version_file": ".vbox_version"
      }],

      "post-processors": [
      {
        "type": "vagrant",
	    "keep_input_artifact": true,
        "compression_level": 9,
        "output": "CentOS7_virtualbox-v{{ user `box_version` }}.box"
      },
	  {
        "type": "manifest",
        "output": "packer_built_virtualbox.json",
        "strip_path": true
      }
      ],

      "provisioners": [
        {
          "environment_vars": [
            "AWS_SWPROXY_FQDN={{user `sw_proxy_fqdn`}}",
            "AWS_SWPROXY_IP={{user `sw_proxy_ip`}}",
            "CHEF_FQDN={{user `chef_fqdn`}}",
            "CHEF_IP={{user `chef_ip`}}",
            "AWS_SWPROXY_PREREQ_DIR={{user `aws_swproxy_prereq_dir`}}",
            "AWS_SWPROXY_ACTIVATION_KEY={{user `aws_swproxy_activation_key`}}"
          ],
          "execute_command": "echo 'vagrant' | {{.Vars}} sudo -S -E sh -eux '{{.Path}}'",
          "expect_disconnect": true
        }
      ]
}
